# PJSK猜歌插件使用说明

## 1. 插件功能简介

本插件是使用《プロジェクトセカイ カラフルステージ！ feat. 初音ミク》/《世界计划 多彩舞台》/《初音未来 缤纷舞台》a.k.a. PJSK经过少量修改的音频资源制作的听歌猜曲游戏。除了经典的猜歌模式，还加入了倒放、变速、纯伴奏、纯贝斯、纯鼓组、纯人声、钢琴重现等多种效果。以及实验中的**猜歌手**功能。

插件内置了积分排行榜、每日游戏次数限制、游戏冷却等功能，并提供一个**轻量模式**选项以优化核心较少服务器的表现。

**注意**：本插件所有必需的音频和数据资源均托管在我的服务器，并已经默认配置，不需要下载（日后可能会上传资源下载供本地使用），资源截止至日服v5.4.0。

## 2. 指令列表

### 游戏指令
- `猜歌` / `gs`: 开始一轮普通模式的猜歌游戏 (1分)。
  - *注: `猜歌` 和 `gs` 后可直接跟数字选择模式，例如 `猜歌1` 和 `猜歌 1` 效果相同。*
- `猜歌 1`: **2倍速**模式 (1分) *(轻量模式下禁用)*。
- `猜歌 2`: **倒放**模式 (3分) *(轻量模式下禁用)*。
- `猜歌 3`: **钢琴旋律重现**模式 (2分)。
- `猜歌 4`: **纯伴奏**模式 (1分)。
- `猜歌 5`: **纯贝斯**模式 (3分)。
- `猜歌 6`: **纯鼓组**模式 (4分)。
- `猜歌 7`: **纯人声**模式 (1分)。
- `随机猜歌` / `rgs`: **核心玩法**。随机组合多种效果，分数越高的组合出现概率越低。
- `猜歌手`: 竞猜歌曲的演唱者 (测试功能, 不计分)。

### 点歌与试听
- `听 <模式> [歌曲名/ID]`: 随机或指定播放一首歌曲的特殊音轨。
  - **可用模式**: `钢琴`, `伴奏`, `人声`, `贝斯`, `鼓组`。
  - **注意**: 按歌曲名搜索时，需要提供完整的官方名称，暂不支持别名或模糊匹配。若查找困难，建议先使用其他查歌机器人获取准确的歌曲名或ID。
  - *所有听歌指令共享每日次数限制。*
  - **示例**:
    - `听钢琴`: 随机播放一首钢琴曲。
    - `听贝斯 Tell Your World`: 播放指定歌曲的贝斯音轨。
    - `听鼓组 3`: 播放ID为3的歌曲的鼓组音轨。

### 数据与帮助
- `猜歌帮助`: 显示本帮助信息。
- `猜歌排行榜` / `gssrank`: 查看猜歌积分排行榜。
- `猜歌分数` / `gsscore`: 查看自己的积分、正确率和排名。
- `查看统计` / `mode_stats`: 查看所有游戏模式的正确率排名。

### 管理员指令
- `测试猜歌 [模式,...] <歌曲名或ID>`: 生成一个测试游戏，立即公布答案，不计入统计。
    - 模式部分可选，支持数字或名称（如 `bass`, `reverse`），用逗号分隔。
    - **示例**: `测试猜歌 5,reverse Tell Your World`
- `重置猜歌次数 [用户ID]`: 重置指定用户（或自己）的每日猜歌次数。
- `重置听歌次数 [用户ID]`: 重置指定用户（或自己）的每日听歌次数。
- `重置题型统计`: 清空所有题型的统计数据。

## 3. 插件配置说明

插件的配置由机器人管理员通过 AstrBot 框架提供的 **WebUI 界面**进行修改。以下是可配置的选项说明：

```json
{
  "group_whitelist": [],
  "super_users": [],
  "answer_timeout": 30,
  "game_cooldown_seconds": 60,
  "daily_play_limit": 15,
  "daily_listen_limit": 5,
  "max_guess_attempts": 10,
  "clip_duration_seconds": 10,
  "bonus_time_after_first_answer": 5,
  "end_game_after_bonus_time": true,
  "debug_mode": false,
  "lightweight_mode": false
}
```
- `group_whitelist` (列表): **群聊白名单**。只有在此列表中的群号才能使用本插件。若列表为空 `[]`，则对所有群聊生效。
- `super_users` (列表): **管理员QQ号列表**。
- `answer_timeout` (整数): 游戏回答的**超时时间**（秒）。
- `game_cooldown_seconds` (整数): 游戏结束后的**冷却时间**（秒）。
- `daily_play_limit` (整数): 每个用户每天可发起**猜歌游戏**的最大次数。
- `daily_listen_limit` (整数): 每日听歌次数限制。'听钢琴'、'听伴奏'、'听人声'、'听贝斯'和'听鼓组'功能共享此限制。
- `max_guess_attempts` (整数): 每轮游戏中，所有玩家总共可以**尝试回答**的次数。
- `clip_duration_seconds` (整数): 播放的音频**片段时长**（秒）。
- `bonus_time_after_first_answer` (整数): 首位答对者出现后，其他玩家可继续得分的**奖励时间**（秒）。设为0则禁用，所有在规定时间内答对的玩家都可得分。
- `end_game_after_bonus_time` (布尔值): 是否在奖励时间结束后**立即结束游戏**。
- `debug_mode` (布尔值): **调试模式**。启用后，游戏会立即显示答案，不计入统计，适合测试。
- `lightweight_mode` (布尔值): **轻量模式**。启用后将禁用部分消耗CPU的音频处理功能（如变速、倒放），只保留从服务器直接下载裁剪的音频功能，以降低服务器负载。
